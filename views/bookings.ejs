<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Booking System</title>
</head>
<body>
    <h1>Flight Booking System</h1>
    <button onclick="window.location.href='/bookings/new'">Book New Flight</button>
    <ul id="bookings">
        <% bookings.forEach(booking => { %>
            <li id="booking-<%= booking._id %>">
                Flight Number: <%= booking.flightNumber %>,
                Passenger Name: <%= booking.passengerName %>,
                <% if (booking.departureDate) { %>
                    Departure Date: <%= new Date(booking.departureDate).toISOString().split('T')[0] %>,
                <% } else { %>
                    Departure Date: Not specified,
                <% } %>
                Seat Number: <%= booking.seatNumber %>,
                Email: <%= booking.email %>
                <form action="/bookings/<%= booking._id %>?_method=DELETE" method="POST" style="display:inline;">
                    <button type="submit">Delete</button>
                </form>
                <form action="/bookings/<%= booking._id %>/edit" method="GET" style="display:inline;">
                    <button type="submit">Update</button>
                </form>
            </li>
        <% }); %>
    </ul>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const socket = io('https://flightbooking.amansirohi.me');  // Adjust the URL if necessary

        const bookingsList = document.getElementById('bookings');

        const addBookingToList = (booking) => {
            const listItem = document.createElement('li');
            listItem.id = `booking-${booking._id}`;
            listItem.innerHTML = `
                Flight Number: ${booking.flightNumber},
                Passenger Name: ${booking.passengerName},
                ${ booking.departureDate ? `Departure Date: ${new Date(booking.departureDate).toISOString().split('T')[0]},` : `Departure Date: Not specified,` }
                Seat Number: ${booking.seatNumber},
                Email: ${booking.email}
                <form action="/bookings/${booking._id}?_method=DELETE" method="POST" style="display:inline;">
                    <button type="submit">Delete</button>
                </form>
                <form action="/bookings/${booking._id}/edit" method="GET" style="display:inline;">
                    <button type="submit">Update</button>
                `;
            bookingsList.appendChild(listItem);
        };

        const updateBookingInList = (booking) => {
            const listItem = document.getElementById(`booking-${booking._id}`);
            if (listItem) {
                listItem.innerHTML = `
                    Flight Number: ${booking.flightNumber},
                    Passenger Name: ${booking.passengerName},
                    ${ booking.departureDate ? `Departure Date: ${new Date(booking.departureDate).toISOString().split('T')[0]},` : `Departure Date: Not specified,` }
                    Seat Number: ${booking.seatNumber},
                    Email: ${booking.email}
                    <form action="/bookings/${booking._id}?_method=DELETE" method="POST" style="display:inline;">
                        <button type="submit">Delete</button>
                    </form>
                    <form action="/bookings/${booking._id}/edit" method="GET" style="display:inline;">
                        <button type="submit">Update</button>
                    </form>
                `;
            }
        };

        const removeBookingFromList = (booking) => {
            const listItem = document.getElementById(`booking-${booking._id}`);
            if (listItem) {
                listItem.remove();
            }
        };

        socket.on('connect', () => {
            console.log('Connected to server');
        });

        socket.on('bookingCreated', (booking) => {
            addBookingToList(booking);
        });

        socket.on('bookingUpdated', (booking) => {
            updateBookingInList(booking);
        });

        socket.on('bookingDeleted', (booking) => {
            removeBookingFromList(booking);
        });
    </script>
</body>
</html>
